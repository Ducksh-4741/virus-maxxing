<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan History ‚Äî ThreatScan</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .search-bar { width:100%; padding:10px 14px; border-radius:8px; border:1px solid #1e2d45;
                      background:#0f172a; color:#e2e8f0; font-size:.93rem; margin-bottom:14px; outline:none; }
        .search-bar:focus { border-color:#3b82f6; }
        #noResults { display:none; color:#64748b; text-align:center; padding:20px; }
    </style>
</head>
<body>
<div class="container">

    <h2>üìú Scan History</h2>

    <input class="search-bar" id="searchInput" placeholder="üîç  Search by filename, hash, result, IP‚Ä¶" oninput="filterTable()">

    {% if scans %}
    <div class="table-wrap">
        <table id="historyTable">
            <tr>
                <th>#</th>
                <th>File</th>
                <th>SHA-256</th>
                <th>MD5</th>
                <th>Result</th>
                <th>Score</th>
                <th>Entropy</th>
                <th>Size</th>
                <th>Type</th>
                <th>IP</th>
                <th>Time</th>
                <th>Flags</th>
            </tr>
            {% for s in scans %}
            <tr>
                <td>{{ s[0] }}</td>
                <td style="max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" title="{{ s[1] }}">{{ s[1] }}</td>
                <td class="hash-cell" title="{{ s[2] }}">{{ s[2][:14] }}‚Ä¶</td>
                <td class="hash-cell" title="{{ s[3] }}">{{ (s[3] or '')[:12] }}‚Ä¶</td>
                <td>
                    <span class="
                        {% if 'Malicious' in s[4] %}malicious
                        {% elif s[4] == 'Suspicious' %}suspicious
                        {% elif s[4] == 'Potentially Unwanted' %}puw
                        {% else %}safe
                        {% endif %}
                    ">{{ s[4] }}</span>
                </td>
                <td style="font-weight:700;
                    {% if s[5] >= 80 %}color:#ef4444
                    {% elif s[5] >= 40 %}color:#facc15
                    {% else %}color:#22c55e
                    {% endif %}">{{ s[5] }}</td>
                <td>{{ s[6] }}</td>
                <td style="color:#64748b;font-size:.8rem;">
                    {% if s[7] %}
                        {% if s[7] < 1024 %}{{ s[7] }}B
                        {% elif s[7] < 1048576 %}{{ (s[7]/1024)|round(1) }}KB
                        {% else %}{{ (s[7]/1048576)|round(2) }}MB
                        {% endif %}
                    {% endif %}
                </td>
                <td style="font-size:.8rem;color:#94a3b8;max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" title="{{ s[8] }}">{{ s[8] or '‚Äî' }}</td>
                <td style="font-size:.8rem;color:#64748b;">{{ s[9] }}</td>
                <td style="font-size:.8rem;color:#64748b;white-space:nowrap;">{{ (s[10] or '')[:16] }}</td>
                <td style="font-size:.75rem;color:#475569;max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" title="{{ s[11] }}">
                    {{ (s[11] or '').split('|')[0] }}{% if '|' in (s[11] or '') %}&hellip;{% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <p id="noResults">No records match your search.</p>
    {% else %}
        <p style="text-align:center;color:#64748b;padding:30px;">No scans yet. Upload a file to get started.</p>
    {% endif %}

    <div class="nav">
        <a href="/">üõ°Ô∏è Scan File</a>
        <a href="/dashboard">üìä Dashboard</a>
    </div>
</div>

<script>
function filterTable() {
    const q = document.getElementById('searchInput').value.toLowerCase();
    const rows = document.querySelectorAll('#historyTable tr:not(:first-child)');
    let visible = 0;
    rows.forEach(row => {
        const match = row.textContent.toLowerCase().includes(q);
        row.style.display = match ? '' : 'none';
        if (match) visible++;
    });
    document.getElementById('noResults').style.display = visible === 0 ? 'block' : 'none';
}
</script>
</body>
</html>
